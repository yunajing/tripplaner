<!DOCTYPE html>
<!-- saved from url=(0050)http://getbootstrap.com/examples/navbar-fixed-top/ -->
<html lang="en" version="g42dymwpi--nx">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="">
<meta name="author" content="yj2270">

<title>Trip Planer</title>

<!-- Bootstrap core CSS -->
<link href="./styles/bootstrap.css" rel="stylesheet">

<!-- Custom styles for this template -->
<link href="./styles/navbar-fixed-top.css" rel="stylesheet">
<link href="./styles/user_style.css" rel="stylesheet">
<link href="./styles/style.css" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="./styles/jquery-ui.css">
<link href="./styles/explorepage.css" type="text/css" rel="stylesheet">
<script src="./script/script.js"></script>
<script src="./script/filer.js"></script>
<script src="./script/jquery-1.10.2.min.js"></script>
<script type="text/javascript"></script>
<link href="./styles/leaflet.css" type="text/css" rel="stylesheet" />
<link href="./styles/apisamples.css" type="text/css" rel="stylesheet" />
<script src="http://code.jquery.com/jquery-1.9.1.js"></script>
<script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
<script src="./script/apisamples.js" type="text/javascript"></script>
<script src="./script/third_party/jquery.ba-bbq.js"
	type="text/javascript"></script>
<script src="./script/third_party/leaflet.js" type="text/javascript"></script>
<script src="./script/third_party/wax.leaf.min.js"
	type="text/javascript"></script>
<style>
    body { font-size: 62.5%; }
    label, input { display:block; }
    input.text { margin-bottom:12px; width:95%; padding: .4em; }
    fieldset { padding:0; border:0; margin-top:25px; }
    h1 { font-size: 12px; margin: .6em 0; }
    div#users-contain { width: 350px; margin: 20px 0; }
    div#users-contain table { margin: 1em 0; border-collapse: collapse; width: 100%; }
    div#users-contain table td, div#users-contain table th { border: 1px solid #eee; padding: .6em 10px; text-align: left; }
    .ui-dialog .ui-state-error { padding: .3em; }
    .validateTips { border: 1px solid transparent; padding: 0.3em; }
</style>
<script>
  var clone;
  var vid;
  var tabCounter=0;
  var calenderList;
  var unsavedCalenders={"Calenders":[]};
  var calendertemplate = '<div class="calendertime"><p>0:00 to 1:00</p><p>1:00 to 2:00</p><p>2:00 to 3:00</p><p>3:00 to 4:00</p><p>4:00 to 5:00</p><p>5:00 to 6:00</p><p>6:00 to 7:00</p><p>7:00 to 8:00</p><p>8:00 to 9:00</p><p>9:00 to 10:00</p><p>10:00 to 11:00</p><p>11:00 to 12:00</p><p>12:00 to 13:00</p><p>13:00 to 14:00</p><p>14:00 to 15:00</p><p>15:00 to 16:00</p><p>16:00 to 17:00</p><p>17:00 to 18:00</p><p>18:00 to 19:00</p><p>19:00 to 20:00</p><p>21:00 to 22:00</p><p>22:00 to 23:00</p><p>23:00 to 24:00</p></div><div class="calenderSlots"><div class="drag_div ui-droppable"></div><div class="drag_div ui-droppable"></div><div class="drag_div ui-droppable"></div><div class="drag_div ui-droppable"></div><div class="drag_div ui-droppable"></div><div class="drag_div ui-droppable"></div><div class="drag_div ui-droppable"></div><div class="drag_div ui-droppable"></div><div class="drag_div ui-droppable"></div><div class="drag_div ui-droppable"></div><div class="drag_div ui-droppable"></div><div class="drag_div ui-droppable"></div><div class="drag_div ui-droppable"></div><div class="drag_div ui-droppable"></div><div class="drag_div ui-droppable"></div><div class="drag_div ui-droppable"></div><div class="drag_div ui-droppable"></div><div class="drag_div ui-droppable"></div><div class="drag_div ui-droppable"></div><div class="drag_div ui-droppable"></div><div class="drag_div ui-droppable"></div><div class="drag_div ui-droppable"></div><div class="drag_div ui-droppable"></div></div></div>';
  $(function() {
    $( "#delete" ).droppable({
      drop: function( event, ui ) {
        deleteItem(ui.draggable);
      }
    });
  });
  function deleteItem( $item ) {
      $item.fadeOut();
      var itemid = $item.attr('id');
      if (itemid.substr(0,3)=="tag"){
        var panelId = $item.remove().attr( "aria-controls" );
        console.log(panelId);
        $( "#" + panelId ).remove();
        $("#tabs").tabs( "refresh" );
      }
  }

  $(function() {
    var tabTitle = $( "#tab_title" );
      tabDate = $( "#tab_date" );
      tabTemplate = "<li><a href='#{href}'>#{label}</a> <span class='ui-icon ui-icon-close' role='presentation'>Remove Tab</span></li>";
 
    // Create new calender dialog init
    var dialog = $( "#createCalendar" ).dialog({
      autoOpen: false,
      modal: true,
      buttons: {
        Add: function() {
          addTab();
          $( this ).dialog( "close" );
        },
        Cancel: function() {
          $( this ).dialog( "close" );
        }
      },
      close: function() {
        form[ 0 ].reset();
      }
    });
 
    // addTab form: calls addTab function on submit and closes the dialog
    var form = dialog.find( "form" ).submit(function( event ) {
      addTab();
      dialog.dialog( "close" );
      event.preventDefault();
    });
 
    // actual addTab function: adds new tab using the input from the form above
    function addTab() {
        tabCounter+=1;
        var label = tabTitle.val() || "newSchedule-" + tabCounter;
        var newTab = {"name":"", "time":"", "event":[]};
        unsavedCalenders['Calenders'].push(newTab);
        console.log(unsavedCalenders);
        id = "tag-" + tabCounter;
        $('#schedule').append(
                            '<li id="'+id+'"><a href="#tabs-'+tabCounter+'">'+label+'</a></li>');
        $("li",$("#schedule")).draggable({
                cancel: "a.ui-icon", // clicking an icon won't initiate dragging
                revert: "invalid", // when not dropped, the item will revert back to its initial position
                containment: "document",
                helper: "clone",
        });
        var tabid = "#tabs-" + tabCounter;
        tabpanel='<div id="tabs-'+tabCounter+'">'+calendertemplate;
        $("#tabs").append(tabpanel);
        $(tabid).droppable(
                    {
                        accept: "div",
                        drop: function( event, ui ) {
                            if ($(this).innerHTML == null || $(this).innerHTML == ''){
                                var draggedid = $(ui.draggable).attr('id');
                                var element = document.getElementById(draggedid).getElementsByTagName("a").item(0)
                                clone = element.cloneNode();
                                console.log($(this).attr('id'));
                                vid= $(this).attr('id');
                                console.log(vid);
                                $( "#dialog-form" ).dialog( "open" );
                                $( "#calenderName").html('<p id= "calenderName" class="validateTips">Adding to Schedule:'+vid.substr(0,vid.length-4)+'</p>');
                                document.getElementById('body').style.overflow="hidden";
                            }
                    }
                }
        )
        $("#tabs").tabs( "refresh" );
    }
 
    // addTab button: just opens the dialog
    $( "#create" )
      .button()
      .click(function() {
        dialog.dialog( "open" );
      });

    $("#create").removeClass("ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only");

    $( "#search" )
      .button()
      .click(function() {
        place = $("#place");
        placeVal = place.val() || "Chicago,IL";
        var keyword = $("#keyword").val() || "High";
        console.log(placeVal+" "+keyword);
        search(placeVal,keyword);
      });
    $("#search").removeClass("ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only");

    $( "#save" )
      .button()
      .click(function() {
        tabs = $("#tabs");
        var panelId = tabs.find(".ui-tabs-active").attr("aria-controls");
        console.log(panelId);
        var temp = panelId.substr(panelId.length-1,panelId.length);
        calenderList['Calenders'].push("tab-"+temp);
        localStorage.setItem('Calenders',JSON.stringify(calenderList));
        localStorage.setItem("tab-"+temp,JSON.stringify(unsavedCalenders["Calenders"][temp]));
        //localStorage.setItem('tabs',document.getElementById(panelId).innerHTML);
      });
    $("#save").removeClass("ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only");
  });


//Adding event to the calender
  $(function() {
      fromHour= $( "#fromHour" ),
      fromMinute = $("#fromMinute"),
      toHour = $( "#toHour" ),
      toMinute = $("#toMinute"),
      comment = $("#comment"),
      allFields = $( [] ).add( fromHour).add( fromMinute).add( toHour).add( toMinute).add( comment ),
      tips = $( ".validateTips" );

        function updateTips( t ) {
              tips
                .text( t )
                .addClass( "ui-state-highlight" );
              setTimeout(function() {
                tips.removeClass( "ui-state-highlight", 1500 );
              }, 500 );
        }
 
        $( "#dialog-form" ).position({
            at: "center center",
        });

    function checkRegexp( o, regexp, n ) {
      if ( !( regexp.test( o.val() ) ) ) {
        o.addClass( "ui-state-error" );
        updateTips( n );
        return false;
      } else {
        return true;
      }
    }

    $( "#dialog-form" ).dialog({
      autoOpen: false,
      height: 300,
      width: 350,
      modal: true,
      buttons: {
        "Add to Calender": function() {
            var bValid = true;
            bValid = bValid && checkRegexp(fromHour,/^([0-9])+$/,"Only Numeric input is allowed for Time");
            bValid = bValid && checkRegexp(fromMinute,/^([0-9])+$/,"Only Numeric input is allowed for Time");
            fTime = fromMinute.val()/60;
            fTime+=fromHour.val()/1;
            if (fTime < 0 || fTime > 24){
                bValid = false;
                updateTips("Input Time exceeds 24 hours");
            }
            bValid = bValid && checkRegexp(toHour,/^([0-9])+$/,"Only Numeric input is allowed for Time");
            bValid = bValid && checkRegexp(toMinute,/^([0-9])+$/,"Only Numeric input is allowed for Time");
            tTime = (toHour.val()/1)+(toMinute.val()/60);
            if (tTime<0 || tTime > 24){
                bValid = false;
                updateTips("Input Time exceeds 24 hours");
            }
            if (tTime <= fTime){
                bValid = false;
                updateTips("Eding Time is prior to Starting Time");
            }
            if (bValid) {
                console.log(clone.href);
                var newEvent = {"fromHour": fromHour.val(), "fromMinute": fromMinute.val(), "toHour": toHour.val(), "toMinute": toMinute.val(), "comment":comment.val(),"placeURL":clone.href,"placeName":clone.innerHTML};
                var temp = vid.substr(vid.length-1,vid.length);
                unsavedCalenders['Calenders'][temp]['event'].push(newEvent);
                var eventId = "tabs-"+unsavedCalenders['Calenders'][temp]['event'].length;
                console.log("Event Added");
                console.log(unsavedCalenders);
                localStorage.setItem("event",JSON.stringify(newEvent));
                var tester = localStorage.getItem("event");
                console.log(tester['fromHour']);
                var t = (tTime-fTime)*26-2;
                var slot = document.getElementById(vid).getElementsByTagName('div').item(1);
                var top = 6+26*fTime;
                $(slot).append('<div id="delete-'+eventId+'" class="event_div" style="top:'+top+'px;height:'+t+'px"></div>');
                $("#delete-"+eventId).append(clone);
                $("#delete-"+eventId).append("<p>"+comment.val()+"</p>");
                $("#delete-"+eventId).draggable({
                    cancel: "a.ui-icon", // clicking an icon won't initiate dragging
                    revert: "invalid", // when not dropped, the item will revert back to its initial position
                    containment: "document",
                    helper: "clone",
                    cursor: "move"
                });
                //$("#"+vid).append('<div id="delete-'+vid+'"draggable="true" ondragstart="drag(event)">'+clone+'</div>');
                allFields.val( "" ).removeClass( "ui-state-error" );
                $( this ).dialog( "close" );
                document.getElementById('body').style.overflow="scroll";
            }
        },
        Cancel: function() {
          $( this ).dialog( "close" );
          document.getElementById('body').style.overflow="scroll";
        }
      },
      close: function() {
        allFields.val( "" ).removeClass( "ui-state-error" );
        document.getElementById('body').style.overflow="scroll";
      }
    });
  });

    var config = {
        apiKey : 'NFAOLYM5EJBOO4RB11JLRMNZNH0ZHQTY0X3KMBYRYUALUPOS',
        apisecret : 'FAAFWOOSW3OB44DEUKWZF2KDTAI3ODHAEKSJ5MCRZWPERCQL',
        authUrl : 'https://foursquare.com/',
        apiUrl : 'https://api.foursquare.com/'
    };
    function search(place, keyword) {
        $.getJSON(config.apiUrl + 'v2/venues/explore?near=' + place
                                + '&query=' + keyword + '&client_id='
                                + config.apiKey + '&client_secret='
                                + config.apisecret,
                        {},
                        function(data) {
                            venues = data['response']['groups'][0]['items'];
                            console.log(document.getElementById("results"));
                            if (document.getElementById("results")==null) {
                                $('#container').append(
                                    '<table id="results" class="search_result">');
                            }
                            /* Place marker for each venue. */
                            
                            else {$('#results').html("");}
                            for (var i = 0; i < venues.length; i++) {
                                var name = venues[i]['venue']['name'];
                                var url = "https://foursquare.com/v/" + name
                                        + "/" + venues[i]['venue']['id'];
                                var address = venues[i]['venue']['location']['address']
                                        + "("
                                        + venues[i]['venue']['location']['crossStreet']
                                        + ")";
                                var price = ";"
                                if (venues[i]['venue']['price']){
                                    var dollars = venues[i]['venue']['price']['tier'];
                                    price = '<span class="venueDataItem"><span class="price" title=""><span class="darken" itemprop="priceRange">';
                                    for (k=0;k<dollars;k++){
                                        price+='$';
                                    }
                                    price+='</span></span>'
                                }
                                else price = '<span class="venueDataItem"><span class="price" title=""><span class="darken" itemprop="priceRange">undefined</span></span>';
                                var venueName = '<div class="venueName"><a href="'+url+'" target="_blank">'+name+'</a></div><span class="venueScore positive" title="">'+venues[i]['venue']['rating']+'</span>';
                                var address = '<div class="venueAddress">'+address+'</div>';
                                
                                
                                var resultblock= '<tr><td><div class="venueBlock" id="drag-'+ i+ '">'
                                                        +'<div class="venueDetails">'
                                                        +venueName+'<div class="venueAddressData">'
                                                        +address
                                                        +'<div class="venueData">'+price+'</div></div></div><div style="clear:both"></div></td></tr>';
                                $('#results').append(resultblock);
                                $("#drag-"+i).draggable({
                                    cancel: "a.ui-icon", // clicking an icon won't initiate dragging
                                    revert: "invalid", // when not dropped, the item will revert back to its initial position
                                    containment: "document",
                                    helper: "clone",
                                    cursor: "move"
                                });
                            }
                            $('#container').append('</table>');
                        })
    }
    function onLoadEvent() {
        if (localStorage.getItem("Calenders")==null){
            calenderList = {"Calenders":[],};
            localStorage.setItem("Calenders",JSON.stringify(calenderList));
        }
        else {
            calenderList = JSON.parse(localStorage.getItem("Calenders"));
        }
        if (calenderList['Calenders'].length==0){
            var newTab = {"name":"", "time":"", "event":[]};
            unsavedCalenders['Calenders'].push(newTab);
            drawTab(newTab,0);
            tabCounter+=1;
        }
        else {
            for(i=0;i<calenderList['Calenders'].length;i++){
                var newTab = JSON.parse(localStorage.getItem(calenderList['Calenders'][i]));
                unsavedCalenders['Calenders'].push(newTab);
                drawTab(newTab,i);
                tabCounter+=1;
            }
        }
        console.log(calenderList);
        var place = 'Chicago,IL';
        var keyword = 'high end';
        tabCounter = localStorage.getItem("tabCounter");
        $("#tabs").tabs().addClass("ui-tabs-vertical ui-helper-clearfix");
        $("#tabs li").removeClass("ui-corner-top").addClass("ui-corner-left");
    }

    function drawTab(newTab,i) {
        var label = newTab['name']||"newSchedule-"+i,
        id = "tag-" + i;
        $('#schedule').append(
                            '<li id="'+id+'"><a href="#tabs-'+i+'">'+label+'</a></li>');
        $("li",$("#schedule")).draggable({
                cancel: "a.ui-icon", // clicking an icon won't initiate dragging
                revert: "invalid", // when not dropped, the item will revert back to its initial position
                containment: "document",
                helper: "clone",
        });
        var tabid = "#tabs-" + i;
        var tempid = "tabs-"+i;
        console.log("tabid");
        tabpanel='<div id="tabs-'+i+'">'+calendertemplate;
        $("#tabs").append(tabpanel);
        $(tabid).droppable(
                    {
                        accept: "div",
                        drop: function( event, ui ) {
                                var draggedid = $(ui.draggable).attr('id');
                                var element = document.getElementById(draggedid).getElementsByTagName("a").item(0)
                                clone = element.cloneNode();
                                console.log($(this).attr('id'));
                                vid= $(this).attr('id');
                                console.log(vid);
                                $( "#dialog-form" ).dialog( "open" );
                                $( "#calenderName").html('<p id= "calenderName" class="validateTips">Adding to Schedule:'+vid.substr(0,vid.length-4)+'</p>');
                                document.getElementById('body').style.overflow="hidden";
                    }
                }
        )
        var counter = 0;
        for (var j=0;j<newTab['event'].length;j++){
                var currentEvent = newTab['event'][counter];
                console.log("aa");
                console.log(counter);
                var fTime = currentEvent['fromHour']/1 + currentEvent['fromMinute']/60;
                var tTime = currentEvent['toHour']/1 + currentEvent['toMinute']/60;
                var eventId = "-"+counter;
                var placeUrl = currentEvent['placeURL'];
                var placeName = currentEvent['placeName'];
                console.log("Event Loaded");
                console.log(currentEvent);
                console.log(eventId);
                var t = (tTime-fTime)*26-2;
                var slot = document.getElementById(tempid).getElementsByTagName('div').item(1);
                var top = 6+26*fTime;
                $(slot).append('<div id="delete-'+eventId+'" class="event_div" style="top:'+top+'px;height:'+t+'px"></div>');
                //console.log(currentEvent['placeURl']);
                $("#delete-"+eventId).append('<a href="'+placeUrl+'" target="_blank">'+placeName+'</a>');
                $("#delete-"+eventId).append("<p>"+currentEvent['comment']+"</p>");
                $("#delete-"+eventId).draggable({
                    cancel: "a.ui-icon", // clicking an icon won't initiate dragging
                    revert: "invalid", // when not dropped, the item will revert back to its initial position
                    containment: "document",
                    helper: "clone",
                    cursor: "move"
                });
                counter+=1;
        }
    }
</script>
</head>
<body id="body" onload="onLoadEvent()">
    <!-- Fixed navbar -->
      <div id="dialog-form" title="Create new user">
        <div id="calenderName"></div>
        <p class="validateTips">All form fields are required.</p>
        <form>
          <fieldset>
            <label for="name">From Hour:</label>
            <input type="text" name="fromHour" id="fromHour" class="text ui-widget-content ui-corner-all">
            <label for="name">From Minute:</label>
            <input type="text" name="fromMinute" id="fromMinute" class="text ui-widget-content ui-corner-all">
            <label for="email">To Hour:</label>
            <input type="text" name="toHour" id="toHour" class="text ui-widget-content ui-corner-all">
            <label for="email">To Minute:</label>
            <input type="text" name="toMinute" id="toMinute" class="text ui-widget-content ui-corner-all">
            <label for="password">Comments:</label>
            <input type="text" name="comment" id="comment" value="" class="text ui-widget-content ui-corner-all">
          </fieldset>
        </form>
      </div>
      <div id="createCalendar" title="Tab data">
          <form>
            <fieldset class="ui-helper-reset">
              <label for="tab_title">Title</label>
              <input type="text" name="tab_title" id="tab_title" value="" class="ui-widget-content ui-corner-all">
              <label for="tab_date">Date</label>
              <textarea name="tab_content" id="tab_content" class="ui-widget-content ui-corner-all"></textarea>
            </fieldset>
          </form>
       </div>
    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse"
                    data-target=".navbar-collapse">
                    <span class="sr-only">Toggle navigation</span> <span
                        class="icon-bar"></span> <span class="icon-bar"></span> <span
                        class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="advanced_calender.html">Trip Planer</a>
            </div>
            <div class="navbar-collapse collapse">
                <ul class="nav navbar-nav">
                    <li id="schedules" class="dropdown"></li>
                </ul>
            </div>
        </div>
        <!--/.nav-collapse -->
    </div>
    <!-- Main component for a primary marketing message or call to action -->
    <div id="container" class="jumbotron">
        <form style="font-size:20px">
        <fieldset class="ui-helper-reset">
          <label for="tab_title">Place</label>
          <input type="text" name="place" id="place" value="" class="ui-widget-content ui-corner-all">
          <label for="tab_date" >Key word</label>
          <input name="tab_content" id="keyword" class="ui-widget-content ui-corner-all"></intput>
        </fieldset>
        </form>
         <button id="search" class="btn btn-default">search</button>
        <div id="tabs">
            <ul id="schedule" class="btn-group-vertical" style="float: left;">
            </ul>
        </div>
        <div class="btn-group" style="position:fixed;top:90%;right:10%;">
            <button id="save" type="button" class="btn btn-default">Save</button>
            <button id="create" type="button" class="btn btn-default">Create Schedule</button>
            <button id="delete" type="button" class="btn btn-default">Delete</button>
        </div>
        <!-- <table id="results" class="search_result"></table> -->

        <div style="clear: both"></div>
</div>